#!/bin/bash
#add fix to exercise5-server1 here
ID_RSA=$(cat <<'EOF'
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
EOF
)

ID_RSA_PUB="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC5PVKsQs54NOfqOmumSrUSLdtUjcrKRdpktiS2Fr4zeWlvkQvDlUzlBNmauPchBTzW34wCu/DnqKQVRMS8HPr5Ab46XhzJRo/Uqfz0dbmYA2ZCAWEuCG64jn70L/npB07Ky208kkfpIg268niBlgza/tK4+OwJ7+TnmD/4NN3J9VJa02xPxQrT8sqX/DbYBtvrMK66jrS+2lmoFONN4HvmCWS/6hU0UFdZa49S4qSDLYSyPirBy06RU9wM5qb5C/DZo2lzqfu8Vi0j7M29a/sX4dUGEQBCmR/oCoppBStFibde7d/lyOm0GCg+5+k+DGIwgUc98D+h3UDoNE3MK6FSB58IpSIRBamurQ7Yw5Wan+dOq1Fm93dUTgcAKERGXWBqWuO28YNenMF7HmiiWn3Ao8/chSD4VYDWRF8QBLV8cUoK69U1lXiYTcGHw71Fgw/aKEzL5TbBuf+YL9YaQxqzgxwRCuAuIPsIiYGfP5FY6w6xSJ0D8cOmR9qgsuqP3U0= vagrant@server2"

sudo -- sh -c "echo 192.168.60.11 server2 >> /etc/hosts"
sudo sed -i 's/^#PubkeyAuthentication yes/PubkeyAuthentication yes/' /etc/ssh/sshd_config
echo "$ID_RSA" > /home/vagrant/.ssh/id_rsa
echo "$ID_RSA_PUB" >> /home/vagrant/.ssh/authorized_keys
chmod 700 /home/vagrant/.ssh
chmod 600 /home/vagrant/.ssh/id_rsa
chmod 600 /home/vagrant/.ssh/authorized_keys
chown vagrant:vagrant /home/vagrant/.ssh/id_rsa
chown vagrant:vagrant /home/vagrant/.ssh
#ssh -o StrictHostKeyChecking=no vagrant@server2